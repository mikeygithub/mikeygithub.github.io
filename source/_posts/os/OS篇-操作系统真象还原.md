---
title: OS篇-操作系统真象还原
index_img: 'https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/czxt-zxhy.png'
hide: false
date: 2021-02-21 22:09:25
category: 操作系统
tags: 操作系统
---

# 条件准备

# 准备知识

## 软件是如何访问硬件的

>硬件是各种各样的,发展速度还是非常快的。各个硬件都有自己的个性,操作系统不可能及时更新各种硬件的驱动方法吧。比如,刚出来某个新硬件,OS 开发者们便开始为其写驱动,这不太现实,会把人累死的。于是乎,便出现了各种硬件适配设备,这就是 IO 接口。接口其实就是标准,大家生产出来的硬件按照这个标准工作就实现了通用。

>硬件在输入输出上大体分为串行和并行,相应的接口也就是串行接口和并行接口。串行硬件通过串行接口与 CPU 通信,反过来也是,CPU 通过串行接口与串行设备数据传输。并行设备的访问类似,只不过是通过并行接口进行的。

访问外部硬件有两个方式。

- (1)将某个外设的内存映射到一定范围的地址空间中,CPU 通过地址总线访问该内存区域时会落到外设的内存中,这种映射让 CPU 访问外设的内存就如同访问主板上的物理内存一样。有的设备是这样做的,比如显卡,显卡是显示器的适配器,CPU 不直接和显示器交互,它只和显卡通信。显卡上有片内存叫显存,它被映射到主机物理内存上的低端 1MB 的 0xB8000~0xBFFFF。CPU 访问这片内存就是访问显存,往这片内存上写字节便是往屏幕上打印内容。看上去这么高大上的做法是怎么实现的,这个我们就不关心了,前面说过,计算机中处处是分层,我们要充分相信上一层的工作。

- (2)外设是通过 IO 接口与 CPU 通信的,CPU 访问外设,就是访问 IO 接口,由 IO 接口将信息传递给另一端的外设,也就是说,CPU 从来不知道有这些设备的存在,它只知道自己操作的 IO 接口,你看,处处体现着分层。于是问题来了,如何访问到 IO 接口呢,答案就是 IO 接口上面有一些寄存器,访问 IO 接口本质上就是访问这些寄存器,这些寄存器就是人们常说的端口。这些端口是人家 IO 接口给咱们提供的接口。人家接口电路也有自己的思维(系统),看到寄存器中写了什么就做出相应的反应。接口提供接口,哈哈,有意思。不过这是人家的约定,没有约定就乱了,各干各的,大家都累,咱们只要遵循人家的规定就能访问成功。

## 用户态与内核态是对

>用户态与内核态是对 CPU 来讲的,是指 CPU 运行在用户态(特权 3 级)还是内核态(特权 0 级), 很多人误以为是对用户进程来讲的。


## 陷入内核

>如果把软件分层的话, 最外圈是应用程序,里面是操作系统,如图 0-1 所示。 应用程序处于特权级 3,操作系统内核处于特权级 0。当用户程序欲 访问系统资源时(无论是硬件,还是内核数据结构),它需要进行系统调用。这样 CPU 便进入了内核态,也称管态。看图中凹下去的部分,是不 是有陷进去的感觉,这就是“陷入内核”。



# 参考资料

[《操作系统真相还原》](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/pdf/操作系统真象还原.pdf)
