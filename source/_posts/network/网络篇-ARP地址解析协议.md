---
title: 网络篇-ARP地址解析协议
index_img: https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/arp-logo.png
date: 2020-12-07 18:08:05
category: 计算机网络
tags: ARP协议
---

# 协议简介

地址解析协议，即ARP（Address Resolution Protocol），是根据IP地址获取物理地址的一个TCP/IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到局域网络上的所有主机，并接收返回消息，以此确定目标的物理地址；

>收到返回消息后将该IP地址和物理地址存入本机`ARP缓存`中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。

地址解析协议是建立在网络中各个主机互相信任的基础上的，局域网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存；
由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗。ARP命令可用于查询本机ARP缓存中IP地址和MAC地址的对应关系、添加或删除静态对应关系等。
相关协议有RARP、代理ARP。NDP用于在IPv6中代替地址解析协议。



- Mac地址

  > **Mac地址**由设备制造商定义/分配，**每一个硬件设备都有一个链路层主地址（MAC地址）**，保存在设备的永久内存中。设备的mac地址不会改变（现在可以进行mac地址伪装） 
  > 　　

- **IP地址**

  > **IP地址**由用户配置给网络接口， 网络接口的IP地址是可以发生变化的**（通过DHCP获取IP，变化速度比较快）**

  

- 查看缓存表

```shell
arp -a
```

显示

```text
接口: 192.168.2.226 --- 0x8
  Internet 地址         物理地址              类型
  192.168.2.1           68-db-54-bb-32-84     动态
  192.168.2.255         ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.251           01-00-5e-00-00-fb     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态
  255.255.255.255       ff-ff-ff-ff-ff-ff     静态
```





# 工作过程

1. 每个主机都会在自己的 ARP 缓冲区中建立一个 ARP 列表，以表示 IP 地址和 MAC 地址之间的对应关系。
2. 主机（网络接口）**新加入网络时**（也可能只是mac地址发生变化，接口重启等）， 会发送免费ARP报文把**自己IP地址与Mac地址的映射关系广播给其他主机。**
3. 网络上的主机接收到免费ARP报文时，会更新自己的ARP缓冲区。将新的映射关系更新到自己的ARP表中。
4. 某个主机需要发送报文时，首先检查 ARP 列表中是否有对应 IP 地址的目的主机的 MAC 地址，如果有，则直接发送数据，如果没有，就向本网段的所有主机发送 ARP 数据包，该数据包包括的内容有：源主机 IP 地址，源主机 MAC 地址，目的主机的 IP 地址等。
5. 当本网络的所有主机收到该 ARP 数据包时：

​       **（A）**首先检查数**据包中的 IP 地址是否是自己的 IP 地址**，如果**不是，则忽略该数据包。**

​       **（B**)  如果是，**则首先从数据包中取出源主机的 IP 和 MAC 地址写入到 ARP 列表中，如果已经存在，则覆盖。**

​       **（C）** 然后将自己的 MAC 地址写入 ARP 响应包中，告诉源主机自己是它想要找的 MAC 地址。

​     6.源主机收到 ARP 响应包后。将目的主机的 IP 和 MAC 地址写入 ARP 列表，并利用此信息发送数据。如果源主机一直没有收到 ARP 响应数据包，表示 ARP 查询失败。


# 参考资料

[ARP地址解析协议原理](https://www.cnblogs.com/csguo/p/7542944.html)  


 