---
title: 网络篇-计算机网络
index_img: 'https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/computer-network.jpeg'
hide: false
date: 2021-02-15 19:17:42
category: 计算机网络
tags: 计算机网络
---

# 第一章 概述

## 计算机网络的定义

>计算机网络主要是由一些通用的、可编程的硬件互连而成的，而这些硬件并非专门用来实现某一特定目的（例如，传送数据或视频信号）。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用。

`互联网`

>特指 Internet，它起源于美国，是由数量极大的各种计算机网络互连起来而形成的一个互连网络。它采用 TCP/IP 协议族作为通信规则，是一个覆盖全球、实现全球范围内连通性和资源共享的计算机网络。

- 第一阶段

  > 从单个网络 ARPANET 向互联网发展的过程。 1983 年，TCP/IP 协议成为 ARPANET 上的标准协议，使得所有使用 TCP/IP 协议的计算机都能利用互连网相互通信。人们把 1983 年作为互联网的诞生时间。1990年，ARPANET 正式宣布关闭。

- 第二阶段

  > 建成了三级结构的互联网。 它是一个三级计算机网络，分为主干网、地区网和校园网（或企业网）。

![image-20210217115739975](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217115739975.png)

- 第三阶段

  > 逐渐形成了多层次 ISP 结构的互联网。 出现了互联网服务提供者 ISP (Internet Service Provider)。任何机构和个人只要向某个 ISP 交纳规定的费用，就可从该 ISP 获取所需 IP 地址的使用权，并可通过该 ISP 接入到互联网。根据提供服务的覆盖面积大小以及所拥有的IP地址数目的不同，ISP 也分成为不同层次的 ISP：主干 ISP、地区 ISP和本地 ISP。

![image-20210217115816104](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217115816104.png)

### 分组交换

> 每一个分组的首部都含有地址（诸如目的地址和源地址）等控制信息。分组交换网中的结点交换机根据收到的分组首部中的地址信息，把分组转发到下一个结点交换机。每个分组在互联网中独立地选择传输路径。用这样的存储转发方式，最后分组就能到达最终目的地。

![image-20210217121147159](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217121147159.png)

### 路由器

> 在路由器中的输入和输出端口之间没有直接连线。路由器处理分组的过程是：
>
> 把收到的分组先放入缓存（暂时存储）；
>
> 查找转发表，找出到某个目的地址应从哪个端口转发；
>
> 把分组送到适当的端口转发出去。

主机和路由器的作用不同

> 主机是为用户进行信息处理的，并向网络发送分组，从网络接收分组。路由器对分组进行存储转发，最后把分组交付目的主机。

分组交换的优点

| **优点** | **所采用的手段**                                             |
| -------- | ------------------------------------------------------------ |
| **高效** | **在分组传输的过程中****动态分配****传输带宽，对通信链路是逐段****占用****。** |
| **灵活** | **为每一个分组****独立****地选择最合适的转发****路由****。** |
| **迅速** | **以分组作为传送单位，可以****不先建立连接****就能向其他主机发送****分组****。** |
| **可靠** | **保证可靠性的网络协议；分布式多路由的分组交换网，使网络有很好的****生存性****。** |

## 网络类别

- 广域网 WAN (Wide Area Network)：作用范围通常为几十到几千公里。
- 城域网 MAN (Metropolitan Area Network)：作用距离约为 5~50 公里。
- 局域网 LAN (Local Area Network) ：局限在较小的范围（如 1 公里左右）。
- 个人区域网 PAN (Personal Area Network) ：范围很小，大约在 10 米左右。

### 计算机网络的性能指标

- 速率
- 带宽
- 吞吐率
- 时延
- 时延带宽积
- 往返时间 RTT
- 利用率

### 速率

> 比特（bit）是计算机中数据量的单位，也是信息论中使用的信息量的单位。
>
> 比特（bit）来源于 binary digit，意思是一个“二进制数字”，因此一个比特就是二进制数字中的一个 1 或 0。速率是计算机网络中最重要的一个性能指标，指的是数据的传送速率，它也称为数据率 (data rate) 或比特率 (bit rate)。
> 速率的单位是 bit/s，或 kbit/s、Mbit/s、 Gbit/s等。
>     例如4  1010  bit/s 的数据率就记为 40 Gbit/s。
> 速率往往是指额定速率或标称速率，非实际运行速率。  

### 带宽

>两种不同意义：
“带宽”(bandwidth) 本来是指信号具有的频带宽度，其单位是赫（或千赫、兆赫、吉赫等）。
在计算机网络中，带宽用来表示网络中某通道传送数据的能力。表示在单位时间内网络中的某信道所能通过的“最高数据率”。单位是 bit/s，即 “比特每秒”。    

![image-20210217121857705](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217121857705.png)

### 吞吐量

>吞吐量 (throughput) 表示在单位时间内通过某个网络（或信道、接口）的数据量。
吞吐量更经常地用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。
吞吐量受网络的带宽或网络的额定速率的限制。  

### 时延

>时延 (delay 或 latency) 是指数据（一个报文或分组，甚至比特）从网络（或链路）的一端传送到另一端所需的时间。
有时也称为延迟或迟延。
网络中的时延由以下几个不同的部分组成：
发送时延
传播时延
处理时延
排队时延

### 时延

>发送时延
也称为传输时延。
发送数据时，数据帧从结点进入到传输媒体所需要的时间。
也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。 

$$
发送时延=\frac{数据帧长度(bit)}{发送速率(bit/s)}
$$

![image-20210217122206127](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217122206127.png)

## 计算机网络的体系结构

>计算机网络的体系结构 (architecture) 是计算机网络的各层及其协议的集合。 
体系结构就是这个计算机网络及其部件所应完成的功能的精确定义。
实现 (implementation) 是遵循这种体系结构的前提下用何种硬件或软件完成这些功能的问题。
体系结构是抽象的，而实现则是具体的，是真正在运行的计算机硬件和软件。

### 协议的体系结构

![image-20210217130824977](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217130824977.png)

### 五层协议的体系结构

![image-20210217133142934](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217133142934.png)



![image-20210217151356453](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217151356453.png)

# 第二章 物 理 层

> 物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是要尽可能地屏蔽掉不同传输媒体和通信手段的差异。用于物理层的协议也常称为物理层规程 (procedure)。

### 数据通信系统的模型

![image-20210217154737343](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217154737343.png)

### 常用编码方式

![image-20210217174400795](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217174400795.png)

### 基本的带通调制方法

![image-20210217180143193](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217180143193.png)

### 物理层下面的传输媒体

![电信领域使用的电磁波的频谱](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217183052436.png)



## 导引型传输媒体

- 双绞线

![image-20210217183955173](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217183955173.png)

- 光纤

![image-20210217184043500](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217184043500.png)

### 复用

![image-20210217184232342](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217184232342.png)

- 频分复用

> 将整个带宽分为多份，用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。频分复用的所有用户在同样的时间占用不同的带宽资源（请注意，这里的“带宽”是频率带宽而不是数据的发送速率）。

![image-20210217184710731](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217184710731.png)

- 时分复用

>时分复用则是将时间划分为一段段等长的时分复用帧（TDM帧）。每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙。
>
>每一个用户所占用的时隙是周期性地出现（其周期就是TDM帧的长度）的。
>
>TDM 信号也称为等时 (isochronous) 信号。
>
>时分复用的所有用户在不同的时间占用同样的频带宽度。

![image-20210217184648314](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217184648314.png)

- 波分复用

![image-20210217185626867](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217185626867.png)

- 码分复用

> 常用的名词是码分多址 CDMA (Code Division Multiple Access)。各用户使用经过特殊挑选的不同码型，因此彼此不会造成干扰。这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。



# 第三章 数据链路层

> 数据链路层是实现设备之间通信的非常重要的一层

![image-20210217223724424](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217223724424.png)

> 数据链路层的作用

![image-20210217225709510](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217225709510.png)

> 数据链路层使用的信道

![image-20210217230114303](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217230114303.png)

> 数据链路层传送的是帧

![image-20210217231437098](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217231437098.png)

链路协议共同问题

- 封装成帧

> 封装成帧 (framing) 就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。首部和尾部的一个重要作用就是进行帧定界。

![image-20210217232327694](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217232327694.png)

- 透明传输

`在数据链路层透明传送数据”表示无论发送什么样的比特组合的数据，这些数据都能够按照原样没有差错地通过这个数据链路层。`

> 如果数据中的某个字节的二进制代码恰好和 SOH 或 EOT 一样，数据链路层就会错误地“找到帧的边界”。

![image-20210217232502288](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217232502288.png)

>解决方法：字节填充 (byte stuffing) 或字符填充 (character stuffing)。
发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”(其十六进制编码是1B)。
接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。
如果转义字符也出现在数据当中，那么应在转义字符前面插入一个转义字符 ESC。当接收端收到连续的两个转义字符时，就删除其中前面的一个。 

- 差错控制

>在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 BER (Bit Error Rate)。
误码率与信噪比有很大的关系。
为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。 
在数据链路层传送的帧中，广泛使用了循环冗余检验 CRC 的检错技术。

### PPP 协议的特点

>对于点对点的链路，目前使用得最广泛的数据链路层协议是点对点协议 PPP (Point-to-Point Protocol)。
PPP 协议在 1994 年就已成为互联网的正式标准。

![image-20210217235335325](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217235335325.png)

>简单 —— 这是首要的要求。
封装成帧 —— 必须规定特殊的字符作为帧定界符。
透明性 —— 必须保证数据传输的透明性。
多种网络层协议 —— 能够在同一条物理链路上同时支持多种网络层协议。
多种类型链路 —— 能够在多种类型的链路上运行。
差错检测 —— 能够对接收端收到的帧进行检测，并立即丢弃有差错的帧。

### PPP 协议有三个组成部分：
- 一个将 IP 数据报封装到串行链路的方法。
- 链路控制协议 LCP (Link Control Protocol)。
- 网络控制协议 NCP (Network Control Protocol)。

### PPP 协议的帧格式

>PPP 帧的首部和尾部分别为 4 个字段和 2 个字段。
标志字段 F = 0x7E （符号“0x”表示后面的字符是用十六进制表示。十六进制的 7E 的二进制表示是 01111110）。
地址字段 A 只置为 0xFF。地址字段实际上并不起作用。
控制字段 C 通常置为 0x03。
PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。

![PPP 协议的帧格式](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210217235923359.png)

### 透明传输问题

>当 PPP 用在异步传输时，就使用一种特殊的`字符填充法`。
当 PPP 用在同步传输链路时，协议规定采用硬件来完成`比特填充`（和 HDLC 的做法一样）。  

字符填充

>将信息字段中出现的每一个 0x7E 字节转变成为 2 字节序列 (0x7D, 0x5E)。 
若信息字段中出现一个 0x7D 的字节, 则将其转变成为 2 字节序列 (0x7D, 0x5D)。
若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面要加入一个 0x7D 字节，同时将该字符的编码加以改变。

![字符填充法](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218000148542.png)

零比特填充

>PPP 协议用在 SONET/SDH 链路时，使用同步传输（一连串的比特连续传送）。这时 PPP 协议采用零比特填充方法来实现透明传输。
在发送端，只要发现有 5 个连续 1，则立即填入一个 0。
接收端对帧中的比特流进行扫描。每当发现 5 个连续1时，就把这 5 个连续 1 后的一个 0 删除。

![零比特填充](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218000246157.png)

## 以太网的 MAC 层

>在局域网中，硬件地址又称为物理地址，或 MAC 地址。 
802 标准所说的“地址”严格地讲应当是每一个站的“名字”或标识符。 
但鉴于大家都早已习惯了将这种 48 位的“名字”称为“地址”，所以本书也采用这种习惯用法，尽管这种说法并不太严格。

#### 48 位的 MAC 地址

> 一个地址块可以生成 224 个不同的地址。这种 48 位地址称为 MAC-48，它的通用名称是 EUI-48。
> 生产适配器时，6 字节的 MAC 地址已被固化在适配器的 ROM，因此，MAC 地址也叫做硬件地址 (hardware address) 或物理地址。
> “MAC 地址”实际上就是适配器地址或适配器标识符 EUI-48。

#### 单站地址，组地址，广播地址

>IEEE 规定地址字段的第一字节的最低位为 I/G 位。I/G 表示 Individual / Group。
当 I/G 位 = 0 时，地址字段表示一个单站地址。
当 I/G 位 = 1 时，表示组地址，用来进行多播（以前曾译为组播）。此时，IEEE 只分配地址字段前三个字节中的 23 位。
当 I/G 位分别为 0 和 1 时，一个地址块可分别生成 223 个单个站地址和 223 个组地址。
所有 48 位都为 1 时，为广播地址。只能作为目的地址使用。

MAC 帧的格式

>常用的以太网 MAC 帧格式有两种标准：
DIX Ethernet V2 标准
IEEE 的 802.3 标准
最常用的 MAC 帧是以太网 V2 的格式。

![以太网 V2 的 MAC 帧格式](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218000626797.png)

#### 以太网交换机的自学习功能

![交换机自学习和转发帧的步骤归纳](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218000843461.png)

# 第四章 网络层

>在计算机网络领域，网络层应该向运输层提供怎样的服务（“面向连接”还是“无连接”）曾引起了长期的争论。
争论焦点的实质就是：在计算机通信中，可靠交付应当由谁来负责？是网络还是端系统？ 

网络提供数据报服务

>互联网的先驱者提出了一种崭新的网络设计思路。
网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。
网络在发送分组时不需要先建立连接。每一个分组（即 IP 数据报）独立发送，与其前后的分组无关（不进行编号）。
网络层不提供服务质量的承诺。即所传送的分组可能出错、丢失、重复和失序（不按序到达终点），当然也不保证分组传送的时限。 

`尽最大努力交付`

>由于传输网络不提供端到端的可靠传输服务，这就使网络中的路由器可以做得比较简单，而且价格低廉（与电信网的交换机相比较）。
如果主机（即端系统）中的进程之间的通信需要是可靠的，那么就由网络的主机中的运输层负责可靠交付（包括差错处理、流量控制等） 。
采用这种设计思路的好处是：网络的造价大大降低，运行方式灵活，能够适应多种应用。
互连网能够发展到今日的规模，充分证明了当初采用这种设计思路的正确性。 

### 分类的 IP 地址

![各类 IP 地址的网络号字段和主机号字段](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218103629104.png)   

> 常用的三种类别的 IP 地址

| **网络 类别** | **最大可**指派的网络数     | **第一个可指派的网络号** | **最后一个可指派的网络号** | **每个网络中最大主机数** |
| ------------- | -------------------------- | ------------------------ | -------------------------- | ------------------------ |
| **A**         | **126 (2**^7 **– 2)**      | **1**                    | **126**                    | **16777214**             |
| **B**         | **16383 (2^14 **– 1)       | **128.1**                | **191.255**                | **65534**                |
| **C**         | **2097151 (2**^21 **– 1)** | **192.0.1**              | **223.255.255**            | **254**                  |

![image-20210218120140987](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218120140987.png)

### IP 地址与硬件地址

>IP 地址与硬件地址是不同的地址。
从层次的角度看，
硬件地址（或物理地址）是数据链路层和物理层使用的地址。
IP 地址是网络层和以上各层使用的地址，是一种逻辑地址（称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的）。

![IP 地址与硬件地址](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218120329039.png)

#### 地址解析协议 ARP 的作用

>已经知道了一个机器（主机或路由器）的IP地址，如何找出其相应的硬件地址？
地址解析协议 ARP 就是用来解决这样的问题的。

![image-20210218120441777](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218120441777.png)

#### 地址解析协议 ARP 要点

>当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址。
如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，然后通过局域网将该 MAC 帧发往此硬件地址。
如没有， ARP 进程在本局域网上广播发送一个 ARP 请求分组。收到 ARP 响应分组后，将得到的 IP 地址到硬件地址的映射写入 ARP 高速缓存。



>ARP请求分组：包含发送方硬件地址 / 发送方 IP 地址 / 目标方硬件地址(未知时填 0) / 目标方 IP 地址。
本地广播 ARP 请求（路由器不转发ARP请求）。
ARP 响应分组：包含发送方硬件地址 / 发送方 IP地址 / 目标方硬件地址 / 目标方 IP 地址。
ARP 分组封装在物理网络的帧中传输。

![image-20210218120903484](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218120903484.png)

### IP 数据报分片

>一数据报的总长度为 3820 字节，其数据部分的长度为 3800 字节（使用固定首部），需要分片为长度不超过 1420 字节的数据报片。
因固定首部长度为 20 字节，因此每个数据报片的数据部分长度不能超过 1400 字节。
于是分为 3 个数据报片，其数据部分的长度分别为 1400、1400 和 1000 字节。
原始数据报首部被复制为各数据报片的首部，但必须修改有关字段的值。

![image-20210218121147165](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218121147165.png)

#### 划分子网的基本思路

>划分子网纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的网络。
从主机号借用若干个位作为子网号 subnet-id，而主机号 host-id 也就相应减少了若干个位。

![image-20210218121348118](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218121348118.png)

>凡是从其他网络发送给本单位某个主机的 IP 数据报，仍然是根据 IP 数据报的目的网络号 net-id，先找到连接在本单位网络上的路由器。
然后此路由器在收到 IP 数据报后，再按目的网络号 net-id 和子网号 subnet-id 找到目的子网。
最后就将 IP 数据报直接交付目的主机。

#### 子网掩码

>从一个 IP 数据报的首部并无法判断源主机或目的主机所连接的网络是否进行了子网划分。
使用子网掩码 (subnet mask) 可以找出 IP 地址中的子网部分。  
规则：
子网掩码长度 ＝ 32 位
子网掩码左边部分的一连串 1，对应于网络号和子网号
子网掩码右边部分的一连串 0，对应于主机号 

![image-20210218130211408](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218130211408.png)

> 默认子网掩码

![image-20210218130757124](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218130757124.png)

#### 子网划分方法

>有固定长度子网和变长子网两种子网划分方法。
在采用固定长度子网时，所划分的所有子网的子网掩码都是相同的。
虽然根据已成为互联网标准协议的 RFC 950 文档，子网号不能为全 1 或全 0，但随着无分类域间路由选择 CIDR 的广泛使用，现在全 1 和全 0 的子网号也可以使用了，但一定要谨慎使用，确认你的路由器所用的路由选择软件是否支持全 0 或全 1 的子网号这种较新的用法。
划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数。

![B 类地址的子网划分选择（使用固定长度子网）](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218133718489.png)

![image-20210218155425062](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218155425062.png)

![image-20210218155444824](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218155444824.png)

### 网际控制报文协议 ICMP 

>为了更有效地转发 IP 数据报和提高交付成功的机会，在网际层使用了网际控制报文协议 ICMP (Internet Control Message Protocol)。
ICMP 是互联网的标准协议。
ICMP 允许主机或路由器报告差错情况和提供有关异常情况的报告。
但 ICMP 不是高层协议（看起来好像是高层协议，因为 ICMP 报文是装在 IP 数据报中，作为其中的数据部分），而是 IP 层的协议。

![image-20210218161048740](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218161048740.png)

ICMP报文种类

- ICMP 报文的种类有两种，即 ICMP 差错报告报文和 ICMP 询问报文。 

- ICMP 报文的前 4 个字节是统一的格式，共有三个字段：即类型、代码和检验和。接着的 4 个字节的内容与 ICMP 的类型有关。 

ICMP 的应用举例

- PING (Packet InterNet Groper) 
- Traceroute 的应用举例

### IPv6

>IP 是互联网的核心协议。
互联网经过几十年的飞速发展，到 2011 年 2 月，IPv4 的 32 位地址已经耗尽。
ISP 已经不能再申请到新的 IP 地址块了。
我国在 2014 – 2015 年也逐步停止了向新用户和应用分配 IPv4 地址。
解决 IP 地址耗尽的根本措施就是采用具有更大地址空间的新版本的 IP，即 IPv6。

#### IPv6 的基本首部

>IPv6 仍支持无连接的传送，但将协议数据单元 PDU 称为分组。为方便起见，本书仍采用数据报这一名词。
所引进的主要变化如下：
更大的地址空间。IPv6 将地址从 IPv4 的 32 位 增大到了 128 位。 
扩展的地址层次结构。 
灵活的首部格式。 IPv6 定义了许多可选的扩展首部。
改进的选项。 IPv6 允许数据报包含有选项的控制信息，其选项放在有效载荷中。

所引进的主要变化如下：

> 允许协议继续扩充。 
> 支持即插即用（即自动配置）。因此 IPv6 不需要使用 DHCP。
> 支持资源的预分配。  IPv6 支持实时视像等要求，保证一定的带宽和时延的应用。
> IPv6 首部改为 8 字节对齐。首部长度必须是 8 字节的整数倍。原来的 IPv4 首部是 4 字节对齐。

### 网络地址转换 NAT

>网络地址转换 NAT (Network Address Translation)  方法于1994年提出。
需要在专用网连接到互联网的路由器上安装 NAT 软件。装有 NAT 软件的路由器叫做 NAT路由器，它至少有一个有效的外部全球IP地址。
所有使用本地地址的主机在和外界通信时，都要在 NAT 路由器上将其本地地址转换成全球 IP 地址，才能和互联网连接。 

![网络地址转换的过程](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218162742773.png)

# 第五章 运输层



![image-20210218170051856](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218170051856.png)

### 进程之间的通信

>从通信和信息处理的角度看，运输层向它上面的应用层提供通信服务，它属于面向通信部分的最高层，同时也是用户功能中的最低层。
当网络的边缘部分中的两个主机使用网络的核心部分的功能进行端到端的通信时，只有位于网络边缘部分的主机的协议栈才有运输层，而网络核心部分中的路由器在转发分组时都只用到下三层的功能。 

![image-20210218171409510](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218171409510.png)

### 运输层的作用

>“逻辑通信”的意思是“好像是这样通信，但事实上并非真的这样通信”。
从IP层来说，通信的两端是两台主机。但“两台主机之间的通信”这种说法还不够清楚。
严格地讲，两台主机进行通信就是两台主机中的应用进程互相通信。
从运输层的角度看，通信的真正端点并不是主机而是主机中的进程。也就是说，端到端的通信是应用进程之间的通信。

![网络层和运输层有明显的区别](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218172141009.png)

![基于端口的复用和分用功能](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218172336702.png)

## 两种不同的运输协议

>但这条逻辑通信信道对上层的表现却因运输层使用的不同协议而有很大的差别。
当运输层采用面向连接的 `TCP `协议时，尽管下面的网络是不可靠的（只提供尽最大努力服务），但这种逻辑通信信道就相当于一条全双工的可靠信道。
当运输层采用无连接的` UDP `协议时，这种逻辑通信信道是一条不可靠信道。 

![可靠信道与不可靠信道](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218172527978.png)

## 运输层的两个主要协议

>TCP/IP 的运输层有两个主要协议：
>
>- 用户数据报协议 UDP (User Datagram Protocol)
>- 传输控制协议 TCP (Transmission Control Protocol)

![image-20210218172838370](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218172838370.png)



### TCP 与 UDP

>两个对等运输实体在通信时传送的数据单位叫作运输协议数据单元 TPDU (Transport Protocol Data Unit)。
TCP 传送的数据单位协议是 TCP 报文段(segment)。
 UDP 传送的数据单位协议是 UDP 报文或用户数据报。 

![image-20210218172940241](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218172940241.png)

![使用 UDP 和 TCP 的典型应用和应用层协议](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218172957509.png)

![两大类、三种类型的端口](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218180348953.png)

![常用的熟知端口](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218180413470.png)

## UDP

- UDP 是`无连接`的，发送数据之前不需要建立连接，，因此减少了开销和发送数据之前的时延。
- UDP 使用`尽最大努力交付`，即不保证可靠交付，因此主机不需要维持复杂的连接状态表。
- UDP 是`面向报文`的。UDP 对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。UDP 一次交付一个完整的报文。 
- UDP 没有拥塞控制，因此网络出现的拥塞不会使源主机的发送速率降低。这对某些实时应用是很重要的。很适合多媒体通信的要求。 
- UDP 支持一对一、一对多、多对一和多对多的交互通信。
- UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短。

![UDP 是面向报文的](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218180728305.png)

## TCP

- TCP 是面向连接的运输层协议，在无连接的、不可靠的 IP 网络服务基础之上提供可靠交付的服务。为此，在 IP 的数据报服务基础之上，增加了保证可靠性的一系列措施。
- TCP 是面向连接的运输层协议。
- 每一条 TCP 连接只能有两个端点 (endpoint)，每一条 TCP 连接只能是点对点的（一对一）。 
- TCP 提供可靠交付的服务。
- TCP 提供全双工通信。
- `面向字节流`
- TCP 中的“流”(stream) 指的是流入或流出进程的字节序列。
- “面向字节流”的含义是：虽然应用程序和 TCP 的交互是一次一个数据块，但 TCP 把应用程序交下来的数据看成仅仅是一连串无结构的字节流。



![TCP 面向流的概念](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218181113075.png)

- TCP 连接是一条虚连接而不是一条真正的物理连接。
- TCP 对应用进程一次把多长的报文发送到 TCP 的缓存中是不关心的。
- TCP 根据对方给出的窗口值和当前网络拥塞的程度来决定一个报文段应包含多少个字节（UDP 发送的报文长度是应用进程给出的）。
- TCP 可把太长的数据块划分短一些再传送。
- TCP 也可等待积累有足够多的字节后再构成报文段发送出去。 

![TCP 报文段的首部格式](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218181409466.png)



# 第六章 应用层

>每个应用层协议都是为了解决某一类应用问题，而问题的解决又往往是通过位于不同主机中的多个应用进程之间的通信和协同工作来完成的。应用层的具体内容就是规定应用进程在通信时所遵循的协议。
应用层的许多协议都是基于客户服务器方式。客户 (client) 和服务器 (server) 都是指通信中所涉及的两个应用进程。客户服务器方式所描述的是进程之间服务和被服务的关系。客户是服务请求方，服务器是服务提供方。 

- DNS
- FTP
- TFTP
- TELNET
- HTTP
- SMTP

![互联网的域名空间](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218181918479.png)

# 第七章 网络安全

![image-20210218182317551](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218182317551.png)

### 分布式拒绝服务 DDoS

> 若从互联网上的成百上千的网站集中攻击一个网站，则称为分布式拒绝服务 DDoS (Distributed Denial of Service)。有时也把这种攻击称为网络带宽攻击或连通性攻击。

### 数据加密模型

![image-20210218182432670](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218182432670.png)

# 第八章 互联网上的音频和视频服务

>计算机网络最初是为传送数据信息设计的。
互联网 IP 层提供的“尽最大努力交付”服务，以及每一个分组独立交付的策略，对传送数据信息也是很合适的。
互联网使用的 TCP 协议可以很好地解决网络不能提供可靠交付这一问题。

## 使用 TCP，还是 UDP？

>传送音频/视频文件可以使用 TCP，也可以使用 UDP。起初人们选用 UDP 来传送。
采用 UDP 会有以下几个缺点：
由于网络的情况多变，在接收端的播放器很难做到始终按规定的速率播放。
很多单位的防火墙往往阻拦外部 UDP 分组的进入，因而使用 UDP 传送  多媒体文件时会被防火墙阻拦掉。
使用 UDP 传送流式多媒体文件时，如果在用户端希望能够控制媒体的     播放，如进行暂停、快进等操作，那么还需要使用另外的协议 RTP 和 RTSP，增加了成本和复杂性。

`现在对流式存储音频/视频的播放，如 YouTube 和 Netflix，都是采用 TCP 来传送。`

![image-20210218182712587](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218182712587.png)

使用 TCP 传送流式视频主要步骤

>用户使用 HTTP 获取存储在万维网服务器中的视频文件，然后把视频数据传   送到 TCP 发送缓存中。若发送缓存已填满，就暂时停止传送。
从 TCP 发送缓存通过互联网向客户机中的 TCP 接收缓存传送视频数据，直到 接收缓存被填满。
从 TCP 接收缓存把视频数据再传送到应用程序缓存（即媒体播放器的缓存）。当这个缓存中的视频数据存储到一定程度时，就开始播放。这个过程一般不超 过 1 分钟。
在播放时，媒体播放器等时地（即周期性地）把视频数据按帧读出，经解压缩 后，把视频节目显示在用户的屏幕上。

`如果是观看实况转播，那么最好应当首先考虑使用 UDP 来传送。
如果使用 TCP 传送，则当出现网络严重拥塞而产生播放的暂停时，就会使人难于接受。
使用 UDP 传送时，即使因网络拥塞丢失了一些分组，对观看的感觉也会比突然出现暂停要好些。`

### 实时流式协议 RTSP

>实时流式协议 RTSP (Real-Time Streaming Protocol) 本身并不传送数据，是一个多媒体播放控制协议。
它以客户服务器方式工作，用来使用户在播放从互联网下载的实时数据时能够进行控制，如：暂停/继续、后退、前进等。因此 RTSP 又称为“互联网录像机遥控协议”。
要实现 RTSP 的控制功能，我们不仅要有协议，而且要有专门的媒体播放器 (media player) 和媒体服务器 (media server)。 

#  第九章 无线网络和移动网络

>无线局域网 WLAN (Wireless Local Area Network) 指采用无线通信技术的局域网。

特点：

>提供了移动接入的功能
节省投资，建网速度较快
支持便携设备联网
由于手机普及率日益增高，通过无线局域网接入到互联网已成为当今上网的最常用的方式。

![image-20210218184106623](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218184106623.png)

![几种无线网络的比较](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/image-20210218184123596.png)



# 参考资料

[计算机网络-PPT](https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/ppt/compute-network.pptx)   


 